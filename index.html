<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Split and Upload</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .ah-con h1 {
      font-weight: 700;
      font-size: 28px;
      color: #212529;
      margin: 0 0 30px 0;
      padding: 20px 0;
      border-bottom: 1px solid #e9ecef;
      text-align: center;
    }

    .ah-con .form-group {
      background: white;
      padding: 20px;
    }

    .ah-con .container {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      padding: 20px;
      border: 1px solid #e9ecef;
      border-radius: 12px;
    }

    .ah-con label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #495057;
    }

    .ah-con input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #ced4da;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .ah-con input:focus {
      outline: none;
      border-color: #0d6efd;
      box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.15);
    }

    .ah-con .date-inputs {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
    }

    .ah-con .date-inputs input {
      flex: 1;
    }

    .ah-con button {
      padding: 12px 24px;
      background-color: #0d6efd;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 16px;
      transition: all 0.2s ease;
      display: block;
      width: 100%;
      margin: 20px 0;
    }

    .ah-con button:hover {
      background-color: #0b5ed7;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .ah-con button:active {
      transform: translateY(0);
    }

    .ah-con #pdfLinks {
      display: none;
      margin-top: 20px;
    }

    .ah-con #pdfLinks a {
      display: block;
      margin: 10px 0;
      color: #0d6efd;
      text-decoration: none;
      padding: 12px 16px;
      border-radius: 8px;
      background-color: #f8f9fa;
      transition: all 0.2s ease;
      border: 1px solid #e9ecef;
    }

    .ah-con #pdfLinks a:hover {
      background-color: #0d6efd;
      color: white;
      border-color: #0d6efd;
      transform: translateX(5px);
    }

    .ah-con #uploadStatus {
      padding: 16px;
      border-radius: 8px;
      text-align: center;
      font-weight: 500;
      background-color: lightgreen;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: none;
      margin-top: 20px;
    }

    .ah-con #uploadStatus.error {
      background-color: #f8d7da;
      color: #721c24;
      border-color: #f5c6cb;
    }

    @media (max-width: 768px) {
      .ah-con h1 {
        font-size: 24px;
      }

      .ah-con .form-group {
        padding: 15px;
      }

      .ah-con .date-inputs {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Split PDF Uploader</h1>
    <div class="ah-con">
      <div class="form-group">
        <div class="date-inputs">
          <div>
            <label for="monthInput">Month:</label>
            <input type="text" id="monthInput" placeholder="MM" maxlength="2">
          </div>
          <div>
            <label for="yearInput">Year:</label>
            <input type="text" id="yearInput" placeholder="YYYY" maxlength="4">
          </div>
        </div>
        <label for="pdfFile">Upload PDF:</label>
        <input type="file" id="pdfFile" accept="application/pdf">
      </div>
      <button id="splitBtn">Split and Upload PDFs</button>
      <div id="pdfLinks"></div>
      <div id="uploadStatus"></div>
    </div>
  </div>

  <script>
    let pdfUrls = [];

    document.addEventListener('DOMContentLoaded', () => {
      function checkLibrariesLoaded() {
        if (typeof PDFLib !== 'undefined' && typeof pdfjsLib !== 'undefined') {
          console.log('Libraries loaded, initializing...');
        } else {
          console.error('Libraries failed to load.');
          alert('Failed to load required libraries. Please check your internet connection.');
          return;
        }
      }
      checkLibrariesLoaded();

      const accessToken = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoQ2xhc3MiOiJMb2NhdGlvbiIsImF1dGhDbGFzc0lkIjoicVFvYWVISzhUVlZKQ1dYVHROV04iLCJzb3VyY2UiOiJJTlRFR1JBVElPTiIsInNvdXJjZUlkIjoiNjhhNGIzMjAwNDhiNTczYjA2ZWZhMzQwLW1laXRoYTZ2IiwiY2hhbm5lbCI6Ik9BVVRIIiwicHJpbWFyeUF1dGhDbGFzc0lkIjoicVFvYWVISzhUVlZKQ1dYVHROV04iLCJvYXV0aE1ldGEiOnsic2NvcGVzIjpbIm1lZGlhcy5yZWFkb25seSIsIm1lZGlhcy53cml0ZSJdLCJjbGllbnQiOiI2OGE0YjMyMDA0OGI1NzNiMDZlZmEzNDAiLCJ2ZXJzaW9uSWQiOiI2OGE0YjMyMDA0OGI1NzNiMDZlZmEzNDAiLCJjbGllbnRLZXkiOiI2OGE0YjMyMDA0OGI1NzNiMDZlZmEzNDAtbWVpdGhhNnYifSwiaWF0IjoxNzU2OTI0MDg5LjQ1MywiZXhwIjoxNzU3MDEwNDg5LjQ1M30.l1mI4Z6S9tUPx5mdDjGEL1HNcmCZfjVEvt5F-m7IOaFWwoydkuHvB-M2fND5cDaDJrCVoLSRVSOhI0U0Y2FO_tCxBMKB0bJwHfCZleUev65Qat6ysfJfjmfKRfMVA2Xrl3mYrqwtzcJWTMJAWcanZxjAK_Nz_DXyd-5pzcCPvvYWyywQ_dPOCYnY3T-mN8-XIU-kaBW-bsMtsVHcf0apyG1biW1ULG8M0XvNBN9VCbQVsTkJDO8eRe9bdyCiGWySzfzjXKVRJDjtXmPkxIgUWXZTJH5mtnnxn2HF-Xr8GdzhwjUHXAu9MSCRXueVTBUrFWNauMPyQrueOtJ1Jl0VgIVmdNSTBDw2DkBucL3pDl3cBuPsZCD6yElvkmfKpUdVvPiJuYZwGBOoF-O2zEMeYnvV5WRPvUBr9JJIN73KIxySlaYnx643-1q7a8ltrqwPP95CKjsU5kBwAnDg0AvOgGpgRNqq77jPuaCpK_o59LzIrbL3xqvm9rC_0RDTMe75-Q5ZnoBuFLMMVDS2eBiY8vBM5uI3Y2I3mm5KDyssqRm9kxdC7hjpUNdiC4IYIY7FgBEAzdFaVmE0iWtIRZxpOSSex58BJEhvJ-63Ag6I89Mlu-pfhbxEo9rGRagRRaMjKLc4uxjBvvjsuE3EpTEifqF_AdwhMzohuf7xgHowHBg';
      // Function to fetch employee data from Google Apps Script
      async function fetchEmployeeData() {
        try {
          const response = await fetch('https://script.google.com/macros/s/AKfycbxnAKhr5gs5RjEdkr7gLonlWM-yomdfS-QckGrVbEyC-sHJnQXfcQjdDuvcYwkCid9ZMA/exec');
          const data = await response.json();
          console.log('Fetched employee data:', data);

          // Convert array to object keyed by EmployeeID (note: EmployeeID is a number, contactID has capital C and I)
          const employeeData = {};
          if (data && Array.isArray(data)) {
            data.forEach(employee => {
              if (employee.EmployeeID !== undefined && employee.contactID) {
                // Convert EmployeeID to string for consistent key access
                const employeeIdStr = employee.EmployeeID.toString();
                employeeData[employeeIdStr] = {
                  name: employee.Name || 'Unknown',
                  contactId: employee.contactID
                };
              }
            });
          }

          console.log('Processed employee data:', employeeData);
          console.log('Available Employee IDs:', Object.keys(employeeData));
          return employeeData;
        } catch (error) {
          console.error('Error fetching employee data:', error);
          // Fallback to empty object if fetch fails
          return {};
        }
      }

      //hgrfghrgh
      async function uploadToGHLMedia(pdfBlob, fileName) {
        const url = 'https://services.leadconnectorhq.com/medias/upload-file';
        const form = new FormData();
        form.append('file', pdfBlob, fileName);
        form.append('hosted', '');
        form.append('fileUrl', '');
        form.append('name', fileName);
        form.append('parentId', '');

        const options = {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${accessToken}`,
            Version: '2021-07-28',
            Accept: 'application/json'
          },
          body: form
        };

        try {
          console.log(`Attempting to upload ${fileName} to GHL Media Library`);
          console.log(`Using access token: ${accessToken.substring(0, 20)}...`);
          
          const response = await fetch(url, options);
          const data = await response.json();
          console.log(`Upload response status: ${response.status}`);
          console.log(`Upload response data:`, data);

          if (!response.ok) {
            console.error('GHL Upload Response:', data);
            if (response.status === 401) {
              throw new Error('Unauthorized: Invalid or expired access token. Please update the access token in the code.');
            } else if (response.status === 400) {
              throw new Error(`Bad Request: ${data.message || 'Invalid request parameters'}`);
            } else if (response.status === 403) {
              throw new Error(`Forbidden: ${data.message || 'Access denied'}`);
            } else if (response.status === 413) {
              throw new Error(`Payload Too Large: ${data.message || 'File too large'}`);
            }
            throw new Error(data.message || `Failed to upload ${fileName} (Status: ${response.status})`);
          }
          console.log(`Successfully uploaded ${fileName} to GHL Media Library`);
          return data;
        } catch (error) {
          console.error(`Error uploading ${fileName} to GHL:`, error);
          if (error instanceof TypeError && error.message.includes('fetch')) {
            throw new Error(`Network error: Unable to connect to GHL server. Please check your internet connection. (${error.message})`);
          }
          throw error;
        }
      }

      async function splitAndUploadPDF() {
        const pdfFileInput = document.getElementById('pdfFile');
        console.log('pdfFileInput:', pdfFileInput);
        console.log('Files:', pdfFileInput.files);
        const monthInput = document.getElementById('monthInput');
        const yearInput = document.getElementById('yearInput');
        const pdfLinksContainer = document.getElementById('pdfLinks');
        const uploadStatus = document.getElementById('uploadStatus');

        // Check if elements exist
        if (!pdfLinksContainer) {
          console.error('Error: pdfLinks element not found in DOM');
          alert('Error: pdfLinks container not found. Please check the HTML.');
          return;
        }
        if (!uploadStatus) {
          console.error('Error: uploadStatus element not found in DOM');
          alert('Error: uploadStatus container not found. Please check the HTML.');
          return;
        }

        pdfLinksContainer.innerHTML = '';
        uploadStatus.innerHTML = '';
        pdfUrls = [];

        if (!pdfFileInput.files || pdfFileInput.files.length === 0) {
          alert('Please upload a PDF file.');
          return;
        }

        const month = monthInput.value.trim();
        const year = yearInput.value.trim();
        if (!month || !year) {
          alert('Please provide both month and year.');
          return;
        }

        // Fetch employee data from Google Apps Script
        uploadStatus.style.display = 'block';
        uploadStatus.innerHTML = 'Fetching employee data...';
        const employeeData = await fetchEmployeeData();
        uploadStatus.innerHTML = 'Processing PDF...';

        try {
          const file = pdfFileInput.files[0];
          if (!file || file.type !== 'application/pdf') {
            throw new Error('No valid PDF file selected. Please upload a PDF.');
          }
          const arrayBuffer = await file.arrayBuffer();

          // Validate PDF and log first 10 bytes for debugging
          const firstBytes = new Uint8Array(arrayBuffer.slice(0, 10));
          const pdfSignature = new TextDecoder().decode(firstBytes);
          console.log('First 10 bytes of uploaded file:', pdfSignature, firstBytes);
          if (!pdfSignature.startsWith('%PDF-')) {
            throw new Error('Uploaded file is not a valid PDF (missing PDF header). First 10 bytes: ' + pdfSignature);
          }

          const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer, { ignoreEncryption: true });
          const pdfjsDoc = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
          const pageCount = pdfDoc.getPageCount();

          if (pageCount === 0) {
            alert('The uploaded PDF is empty.');
            return;
          }

          // Parse employee ID from the first page
          let topRightEmployeeID = null;
          const firstPage = await pdfjsDoc.getPage(1);
          const textContent = await firstPage.getTextContent();
          const viewport = firstPage.getViewport({scale: 1});
          const pageHeight = viewport.height;

          // Debug: Log all text items
          console.log(`Page 1 all text items (pageHeight: ${pageHeight}, count: ${textContent.items.length}):`);
          for (const item of textContent.items) {
            const { str, transform } = item;
            const x = transform[4];
            const y = pageHeight - transform[5];
            console.log(`  "${str || '[empty]'}" at x=${x.toFixed(1)}, y=${y.toFixed(1)} (rawY: ${transform[5].toFixed(1)})`);
          }

          // Find "C贸d." and "trab." anywhere on the page (more flexible matching)
          let codX = 0, codY = 0, trabX = 0, trabY = 0;
          for (const item of textContent.items) {
            const { str, transform } = item;
            const x = transform[4];
            const y = pageHeight - transform[5];
            const cleanStr = str.trim().toLowerCase();

            // Check for combined "C贸d. trab."
            if (cleanStr.includes("c贸d") && cleanStr.includes("trab")) {
              codX = x;
              trabX = x + 50; // approximate width
              codY = y;
              trabY = y;
              console.log(`Found "C贸d. trab." combined at x=${codX}, y=${codY} (text: "${str.trim()}")`);
            } else if (cleanStr.includes("c贸d")) {
              codX = x;
              codY = y;
              console.log(`Found "C贸d." at x=${codX}, y=${codY} (text: "${str.trim()}")`);
            } else if (cleanStr.includes("trab")) {
              trabX = x;
              trabY = y;
              console.log(`Found "trab." at x=${trabX}, y=${trabY} (text: "${str.trim()}")`);
            }
          }

          // If found both parts, look for the number near them (same row or below)
          if (codX > 0 && trabX > 0) {
            const labelCenterX = (codX + trabX) / 2;
            const labelY = codY; // Use the y of "C贸d."

            for (const item of textContent.items) {
              const { str, transform } = item;
              const x = transform[4];
              const y = pageHeight - transform[5];

              if (str.trim().match(/^\d+$/) && Math.abs(y - labelY) < 30 && x > labelCenterX && x < labelCenterX + 100) {
                topRightEmployeeID = str.trim();
                console.log(`Found ID "${topRightEmployeeID}" near "C贸d. trab." at x=${x}, y=${y}`);
                break;
              }
            }
          }

          // Fallback: if not found, look for any number in top-right area
          if (!topRightEmployeeID) {
            for (const item of textContent.items) {
              const { str, transform } = item;
              const x = transform[4];
              const y = pageHeight - transform[5];

              if (y < 200 && x > viewport.width * 0.6 && str.trim().match(/^\d+$/) && str.trim().length <= 3) {
                topRightEmployeeID = str.trim();
                console.log(`Fallback found ID "${topRightEmployeeID}" at x=${x}, y=${y}`);
                break;
              }
            }
          }

          console.log(`Parsed Employee ID from PDF: "${topRightEmployeeID}" (type: ${typeof topRightEmployeeID})`);

          if (!topRightEmployeeID || !employeeData[topRightEmployeeID]) {
            const availableIds = Object.keys(employeeData);
            console.error(`Employee ID "${topRightEmployeeID}" not found. Available IDs:`, availableIds);
            console.error('Employee data keys and types:', availableIds.map(id => `${id} (${typeof id})`));
            throw new Error(`Employee ID "${topRightEmployeeID}" not found in employee database. Available IDs: ${availableIds.join(', ')}. Please check if the employee data is correctly set up in the Google Sheet.`);
          }

          uploadStatus.style.display = 'block'; // Show uploadStatus
          uploadStatus.innerHTML = 'Splitting PDF and generating links...';
          const pdfLinks = [];

          const data = employeeData[topRightEmployeeID];
          const fullName = data.name;
          const clientId = data.contactId;
          console.log(`Matched Employee ID ${topRightEmployeeID} to ${fullName} with Contact ID ${clientId}`);

          for (let i = 0; i < pageCount; i++) {
            const newDoc = await PDFLib.PDFDocument.create();
            const [copiedPage] = await newDoc.copyPages(pdfDoc, [i]);
            newDoc.addPage(copiedPage);

            const pdfBytes = await newDoc.save();
            const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
            const pdfUrl = URL.createObjectURL(pdfBlob);
            pdfUrls.push(pdfUrl);

            const fileName = `${month}_${year}_${topRightEmployeeID}_${clientId}.pdf`;
            pdfLinks.push({
              url: pdfUrl,
              fileName,
              text: `${fullName} ${clientId} ${month}/${year}`,
              clientUrl: `client.html?contactId=${clientId}`
            });

            await uploadToGHLMedia(pdfBlob, fileName);

            storeClientPDFs(clientId, fullName, month, year, topRightEmployeeID, fileName);
          }

          pdfLinksContainer.style.display = 'block'; // Show pdfLinks
          pdfLinks.forEach(({ url, fileName, text, clientUrl }) => {
            const linkContainer = document.createElement('div');
            linkContainer.style.cssText = 'margin: 10px 0; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; background: #f8f9fa;';

            const downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.download = fileName;
            downloadLink.textContent = ` ${text}`;
            downloadLink.style.cssText = 'display: block; color: #0d6efd; text-decoration: none; font-weight: 500; margin-bottom: 8px;';
            downloadLink.onmouseover = () => downloadLink.style.textDecoration = 'underline';
            downloadLink.onmouseout = () => downloadLink.style.textDecoration = 'none';

            const clientLink = document.createElement('a');
            clientLink.href = clientUrl;
            clientLink.textContent = ' View in Client Portal';
            clientLink.style.cssText = 'display: inline-block; color: #28a745; text-decoration: none; font-weight: 500; font-size: 14px;';
            clientLink.target = '_blank';
            clientLink.onmouseover = () => clientLink.style.textDecoration = 'underline';
            clientLink.onmouseout = () => clientLink.style.textDecoration = 'none';

            linkContainer.appendChild(downloadLink);
            linkContainer.appendChild(clientLink);
            pdfLinksContainer.appendChild(linkContainer);
          });

          alert(`Generated and uploaded ${pageCount} PDF(s) successfully! Click the links below to download or view in client portal.`);
          uploadStatus.innerHTML = `Generated and uploaded ${pageCount} PDF(s) successfully!`;
          pdfFileInput.value = ''; // Clear the file input
          setTimeout(() => {
            location.reload(); // Refresh the page after 3 seconds
          }, 3000);
        } catch (error) {
          uploadStatus.style.display = 'block'; // Show uploadStatus on error
          uploadStatus.className = 'error';
          uploadStatus.innerHTML = `Error: ${error.message}`;
          console.error('Full error details:', error);
          if (error.stack) {
            console.error('Error stack trace:', error.stack);
          }
        }
      }

      document.getElementById('splitBtn').addEventListener('click', splitAndUploadPDF);


      function storeClientPDFs(clientId, fullName, month, year, employeeID, fileName) {
        try {
          const storedData = localStorage.getItem('generatedPdfs');
          const allPdfs = storedData ? JSON.parse(storedData) : {};

          if (!allPdfs[clientId]) {
            allPdfs[clientId] = [];
          }

          const timestamp = new Date().toISOString();
          allPdfs[clientId].push({
            fullName,
            clientId,
            month,
            year,
            employeeID,
            fileName,
            clientUrl: `client.html?contactId=${clientId}`,
            timestamp
          });

          localStorage.setItem('generatedPdfs', JSON.stringify(allPdfs));
          console.log(`Stored PDF metadata for client ${clientId} with client portal URL`);
        } catch (error) {
          console.error('Error storing PDF information:', error);
        }
      }

      window.addEventListener('unload', () => {
        pdfUrls.forEach(url => URL.revokeObjectURL(url));
      });
    async function fetchMediaFiles() {
      const url = 'https://services.leadconnectorhq.com/medias/files?sortBy=createdAt&sortOrder=asc&altType=location';
      const options = {
        method: 'GET',
        headers: {
          Authorization: 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRoQ2xhc3MiOiJMb2NhdGlvbiIsImF1dGhDbGFzc0lkIjoicVFvYWVISzhUVlZKQ1dYVHROV04iLCJzb3VyY2UiOiJJTlRFR1JBVElPTiIsInNvdXJjZUlkIjoiNjhhNGIzMjAwNDhiNTczYjA2ZWZhMzQwLW1laXRoYTZ2IiwiY2hhbm5lbCI6Ik9BVVRIIiwicHJpbWFyeUF1dGhDbGFzc0lkIjoicVFvYWVISzhUVlZKQ1dYVHROV04iLCJvYXV0aE1ldGEiOnsic2NvcGVzIjpbIm1lZGlhcy5yZWFkb25seSIsIm1lZGlhcy53cml0ZSIsImNvbnRhY3RzLnJlYWRvbmx5IiwiY29udGFjdHMud3JpdGUiXSwiY2xpZW50IjoiNjhhNGIzMjAwNDhiNTczYjA2ZWZhMzQwIiwidmVyc2lvbklkIjoiNjhhNGIzMjAwNDhiNTczYjA2ZWZhMzQwIiwiY2xpZW50S2V5IjoiNjhhNGIzMjAwNDhiNTczYjA2ZWZhMzQwLW1laXRoYTZ2In0sImlhdCI6MTc1NjQ5MzMwOC41MTcsImV4cCI6MTc1NjU3OTcwOC41MTd9.SbgkpxDLlOYgFTp5rnMfi2d-wKWtSZnZZOeAVTehkMnDmNReQA_-E92RKT57NSFBMVqrPumfN1kk8tRmswWiMQCkyxrIwHTnV7HtD32iW6-tc0_49FO30TjDH60mB8amkTVlf3ByVjBtCk9x4vr9CfRORzsrsRgGbXrOU5520d5KhuvN1enzRD1DVg_oKW51qcwm-X3aePc_2QAHcWSWI8GEndQH7gKSR00mrrG5KfvyBafzGIz8Y-jFr5C-ttLO61nD6kDuWAjlk-ewPDlPxq2ytZmGMLIMirnr1ywudTjUeM0bSCQNAqd7RYNChdRceMLQNhu0xsaPt5Kz-v5f4YyrOhnpmIGlC1XQYTo0xGcnqDPWAR-wvHuslIzEyyUUUJqGtkhrJmPhs-37dFG4hXXhCskdZSqBVQnhdQVxA6sEQCTJ0lXK0uTbTE6qUoa2hGOHcCMjt667SkKyLJMcaP-kfXznEsYik81CbSF5oPYvCt3uP14-MdhfkPe9U6E222PUtQ-9APRrcMuEn2KvIRE3UbNN0yYkMfJ8q94z5eZ4AaZINpI8XfF8BN6mMgMDRc9tlvSYcLRwixRYRoPhjwVyVNsbQdslwE26LrZ-TJ_t3_ziwTmp4K6DUoyZshGlASRa4s_mLLRtioZDaFb6cSDbebRkKd5sulJxlDJsJ_U',
          Version: '2021-07-28',
          Accept: 'application/json'
        }
      };

      try {
        const response = await fetch(url, options);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Fetched media files:', data);
        return data;
      } catch (error) {
        console.error('Error fetching media files:', error);
        throw error;
      }
    }
    }); // Close DOMContentLoaded here
  </script>
</body>
</html>